
**TECHNICAL SPECIFICATION FOR UPDATING TELEGRAM BOT ON REPLIT (ENGLISH)**

### **Goal**
Implement new features for the existing Telegram bot on Replit. The bot should:
- Always communicate with users **in Russian**.
- Be **intuitive and user-friendly**.
- Retain the existing content plan functionality **unchanged**.
- Be expanded with product repackaging and message chain tools.
- Optimize usage of ChatGPT.

---

## **1. Optimization of Resource Usage and Data Storage**

### Requirements:
- Use **GPT-4-Turbo** for content generation.
- Save the user's tone of voice, audience, and content theme in SQLite on first input.
- If user data already exists, use the saved data in prompts without re-requesting.
- Add a main menu button **Â«ğŸ”„ ĞĞ°Ñ‡Ğ°Ñ‚ÑŒ Ğ·Ğ°Ğ½Ğ¾Ğ²Ğ¾Â»** so users can reset their data and input new preferences.

### Example SQLite table:
```sql
CREATE TABLE IF NOT EXISTS user_data (
  chat_id INTEGER PRIMARY KEY,
  tone_of_voice TEXT,
  audience TEXT,
  content_theme TEXT
);
```

---

## **2. Secondary Bot for Message Chains, Broadcasts, and Stats**

### Features:
- Schedule **a chain of messages** to be sent after a user subscribes to the main bot.
- Send **a one-time broadcast message** to all users within 1 minute.
- Provide **statistics** about total subscribers and broadcast delivery results.

### Message Chain Implementation:
1. Admin opens the second bot.
2. Clicks **Â«â• Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğµ Ğ² Ñ†ĞµĞ¿Ğ¾Ñ‡ĞºÑƒÂ»**.
3. Inputs:
   - Text of the message
   - Attaches image/video (optional)
   - Sets **when** to send it (X minutes/hours/days after subscription)
4. Clicks **Â«âœ… Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½Ğ¸Ñ‚ÑŒÂ»**
5. The bot confirms and offers **Â«â• Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ ĞµÑ‰Ñ‘ Ğ¾Ğ´Ğ½Ğ¾ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸ĞµÂ»**
6. The admin repeats steps 3â€“5 to build the full chain.
7. Messages are saved in:
```sql
CREATE TABLE IF NOT EXISTS scheduled_messages (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  step_order INTEGER,
  message_type TEXT,
  content TEXT,
  media_url TEXT,
  delay_minutes INTEGER
);
```
8. The main bot stores `chat_id` and subscription timestamp.
9. The second bot checks who and when should receive the next message.

### Message Chain Management Enhancements:
In addition to adding messages to the sequence, the admin bot must support:

- ğŸ”„ **Editing existing messages** in the chain.
- âŒ **Deleting specific messages** from the chain.
- ğŸ“‹ **Listing all scheduled messages** with their order and delay time for easy review and management.

The admin interface should allow the user to:
1. View the full current sequence with numbered steps.
2. Select a message to edit (text/media/delay).
3. Select a message to delete.
4. Confirm before deletion or saving edits.

These controls should be accessible from the same menu as message creation and clearly labeled for ease of use.

### Broadcast Messaging:
1. Admin clicks **Â«ğŸ“¢ ĞœĞ°ÑÑĞ¾Ğ²Ğ°Ñ Ñ€Ğ°ÑÑÑ‹Ğ»ĞºĞ°Â»**.
2. Inputs message and attaches media (if needed).
3. Confirms.
4. Bot sends message to all users within 1 minute.
5. Bot replies: **Â«Ğ¡Ğ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğµ Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¾ [N] Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑĞ¼Â»**

### Statistics:
- Admin menu includes **Â«ğŸ‘¥ ĞŸĞ¾Ğ´Ğ¿Ğ¸ÑÑ‡Ğ¸ĞºĞ¸Â»** button.
- Shows:
  - Total number of subscribers
  - Last broadcast stats: **Â«ĞŸĞ¾ÑĞ»ĞµĞ´Ğ½ÑÑ Ñ€Ğ°ÑÑÑ‹Ğ»ĞºĞ° Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ° X Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑĞ¼Â»**

### Subscriber table:
```sql
CREATE TABLE IF NOT EXISTS subscribers (
  chat_id INTEGER PRIMARY KEY,
  joined_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

---

## **3. Main Bot Menu (in Russian):**
```
ğŸ“‹ ĞšĞ¾Ğ½Ñ‚ĞµĞ½Ñ‚-Ğ¿Ğ»Ğ°Ğ½ / ĞŸĞ¾ÑÑ‚Ñ‹
ğŸ¯ ĞŸĞµÑ€ĞµÑƒĞ¿Ğ°ĞºĞ¾Ğ²ĞºĞ° Ğ¿Ñ€Ğ¾Ğ´ÑƒĞºÑ‚Ğ°
ğŸ”„ ĞĞ°Ñ‡Ğ°Ñ‚ÑŒ Ğ·Ğ°Ğ½Ğ¾Ğ²Ğ¾
```

### When user clicks **ğŸ“‹ ĞšĞ¾Ğ½Ñ‚ĞµĞ½Ñ‚-Ğ¿Ğ»Ğ°Ğ½ / ĞŸĞ¾ÑÑ‚Ñ‹**:
- Launch existing content plan/post generation functionality.
- **Do not change structure or logic.**

---

## **4. New Feature: ğŸ¯ ĞŸĞµÑ€ĞµÑƒĞ¿Ğ°ĞºĞ¾Ğ²ĞºĞ° Ğ¿Ñ€Ğ¾Ğ´ÑƒĞºÑ‚Ğ°**

### Input sequence:
1. **Â«ĞšÑ‚Ğ¾ Ñ‚Ğ²Ğ¾Ñ Ğ°ÑƒĞ´Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ñ?Â»**
   Example: Â«ĞŸÑ€ĞµĞ´Ğ¿Ñ€Ğ¸Ğ½Ğ¸Ğ¼Ğ°Ñ‚ĞµĞ»Ğ¸ Ğ¸ Ğ±Ğ»Ğ¾Ğ³Ğ³ĞµÑ€Ñ‹, ĞºĞ¾Ñ‚Ğ¾Ñ€Ñ‹Ğµ Ğ¿Ñ€Ğ¾Ğ´Ğ°ÑÑ‚ Ñ‚Ğ¾Ğ²Ğ°Ñ€ Ğ¸Ğ»Ğ¸ ÑƒÑĞ»ÑƒĞ³ÑƒÂ»
2. **Â«ĞšĞ°ĞºĞ¾Ğ¹ Ğ¸Ğ½ÑÑ‚Ñ€ÑƒĞ¼ĞµĞ½Ñ‚ Ñ‚Ñ‹ Ğ´Ğ°ĞµÑˆÑŒ?Â»**
   Example: Â«ĞšĞ°Ğº ÑĞ½ÑÑ‚ÑŒ Ñ€Ğ¸Ğ»Ñ Ğ½Ğ° 1 Ğ¼Ğ»Ğ½ Ğ¿Ñ€Ğ¾ÑĞ¼Ğ¾Ñ‚Ñ€Ğ¾Ğ²Â»
3. **Â«ĞšĞ°ĞºĞ¾Ğ¹ Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚ Ğ¾Ğ½Ğ¸ Ğ¿Ğ¾Ğ»ÑƒÑ‡Ğ°Ñ‚?Â»**
   Example: Â«Ğ Ğ¸Ğ»Ñ Ñ 1 Ğ¼Ğ»Ğ½ Ğ¿Ñ€Ğ¾ÑĞ¼Ğ¾Ñ‚Ñ€Ğ¾Ğ² Ğ¿Ñ€Ğ¸Ğ½ĞµÑĞµÑ‚ Ğ¿Ñ€Ğ¾Ğ´Ğ°Ğ¶Ğ¸Â»

### ChatGPT Prompt:
(Ñ‚ĞµĞºÑÑ‚ Ğ¿Ñ€Ğ¾Ğ¼Ğ¿Ñ‚Ğ° â€” ĞºĞ°Ğº Ğ² Ğ¿Ñ€ĞµĞ´Ñ‹Ğ´ÑƒÑ‰ĞµĞ¼ ÑˆĞ°Ğ³Ğµ)

---

## **5. User Interface**
- Every step must have **Â«ğŸ”™ Ğ’ĞµÑ€Ğ½ÑƒÑ‚ÑŒÑÑ Ğ² Ğ¼ĞµĞ½ÑÂ»** button.
- Second bot menu must have buttons for:
  - Add message to chain
  - Set message delay
  - Edit/Delete/View chain messages
  - Broadcast message
  - View subscriber stats

---

## **6. Subscription Check (IMPORTANT)**
The bot must preserve the existing logic that checks whether the user is subscribed to the channel **@expert_buyanov**.

- The bot **must not allow** access to its functions unless the user is subscribed.
- This check is currently implemented and **must remain active and functional** after updates.
- It should be triggered at the beginning of any interaction or after clicking any menu option.

---

## **Final Notes**
- Functional expansion is implemented without changing the core logic.
- Chain messaging, broadcast and statistics improve automation and user engagement.
- Product repackaging reflects perceived value using marketing formula.
- The interface is intuitive and designed for non-technical users.

Ready for integration in Replit.
